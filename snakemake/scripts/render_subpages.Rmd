```{r render_subpages, include=F}
# Create temporary environment which we use for knitting subpages.RMD 
# subpage_env <- new.env()

# Create variable which stores all subpages outputs
# out = NULL
 
# out = pmap(payloads_sub, function(type, category, heading, flavour_text, analysis, gene_set, expr_data, sp_info) {
#   
#   if(type %in% c("Disease", "ConsensusPathDB")) {
#     # TODO move add human id here, not to interfere with overview table after summarizing
#     expr_data = expr_data %>%
#       add_human_ids(sp_info)
#     select_entrez_id = "ENTREZID_HUMAN"
#   } else {
#     select_entrez_id = "ENTREZID"
#   }
# 
#   if(analysis %in% c("ORA")) {
#     expr_data = filter_data(expr_data, 
#                             padj_column = padj_column_name, 
#                             padj_threshold = gene_padj_threshold, 
#                             fc_column = fc_column_name, 
#                             fc_threshold = gene_fc_threshold)
#     
#   } else if(analysis %in% c("GSEA")) {
#     # TODO implement custom ordering
#   }
# 
#   geneList = structure(expr_data[ ,fc_column_name], names = as.character(expr_data[ ,select_entrez_id])) %>%
#     sort(decreasing = T)
#   
#   if(length(filter_gene_list(geneList, gene_set)) < 1) { return("") }
#   # Generate enrichResult or gseaResult dataframe to pass as data to subpage
#   df = get_function(type, analysis)(filter_gene_list(geneList, gene_set), category, sp_info)
#   if(nrow(data.frame(df)) == 0 | is.null(df)) { return("") }
#   if(df@readable == FALSE) {df = setReadable(df, sp_info['orgdb'], keyType = "ENTREZID")}
#   
#   assign("subpage_item", paste0(analysis, " - ", gene_set), subpage_env)
#   assign("subpage_category", heading, subpage_env)
#   assign("subpage_heading", paste0(heading, " - ", analysis, " - ", gene_set), subpage_env)
#   assign("geneList", geneList, subpage_env)
#   assign("subpage_data", df, subpage_env)
#   
#   # csv_path = paste0("../../csv/", outdir, "/")
#   # dir.create(csv_path, showWarnings = F)
#   # pathways_to_table(df,
#   #                   geneList,
#   #                   paste0(csv_path,
#   #                          gsub(" ", "_", paste(type, category, analysis, gene_set)),
#   #                          "_",
#   #                          template,
#   #                          ".txt"))
#   
#   # return(knitr::knit_child('subpage.Rmd', envir = subpage_env))
#   return(subpage_env)
# }, expr_data = data, sp_info = sp_info)

out = map(all_cp, function(x) {
  if(!is.null(x)) {
    create_subpage_markdown(x)
  }
})

```

`r paste(knitr::knit_child(text = out), collapse = '')`